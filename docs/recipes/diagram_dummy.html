<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
  <script src="https://chetabahana.github.io/flowchart/flowchart-latest.js"></script>

  <a id="diagram_download" style="font-family:Helvetica;"><i class="fa-solid fa-download"></i> Download SVG</a>

  <div id="diagram"></div>
  <script>

    var diagram_str = `data0_1=>operation: n = 10|data
cond1(align-next=no)=>parallel: Patients over 18 y.o.|criterion
data_excluded_1=>operation: n = 4|data
data1_2=>operation: n = 6|data
cond2(align-next=no)=>parallel: Patients over 18 y.o.
With Type I or II diabetes|criterion
data_excluded_2=>operation: n = 4|data
data2_3=>operation: n = 2|data
cond3(align-next=no)=>parallel: Patients over 18 y.o.
With Type I or II diabetes
With infarction|criterion
data_excluded_3=>operation: n = 1|data
data3_4=>operation: n = 1|data

data0_1->cond1->data1_2->cond2->data2_3->cond3

cond1(path1, bottom)->data1_2
cond1(path1, bottom)@>data1_2({"arrow-end":"none"})
cond1(path2, right)->data_excluded_1
cond2(path1, bottom)->data2_3
cond2(path1, bottom)@>data2_3({"arrow-end":"none"})
cond2(path2, right)->data_excluded_2
cond3(path1, bottom)->data3_4
cond3(path1, bottom)@>data3_4({"arrow-end":"none"})
cond3(path2, right)->data_excluded_3`;
    var diagram = flowchart.parse(diagram_str)

    diagram.drawSVG('diagram', {
      'x': 0,
      'y': 0,
      'line-width': 3,
      'line-length': 50,
      'text-margin': 10,
      'font-size': 14,
      'font-color': 'black',
      'line-color': 'black',
      'element-color': 'black',
      'fill': 'white',
      'yes-text': 'yes',
      'no-text': 'no',
      'arrow-end': 'block',
      'scale': 1,
      // style symbol types
      'symbols': {
        'start': {
          'font-color': 'red',
          'element-color': 'green',
          'fill': 'yellow'
        },
        'end': {
          'class': 'end-element'
        }
      },
      // even flowstate support ;-)
      'flowstate': {
        'data': { 'fill': 'white' },
        'criterion': { 'fill': 'grey' },
      }
    });


    var svg = document.getElementById("diagram").firstChild;

    //get svg source.
    var serializer = new XMLSerializer();
    var source = serializer.serializeToString(svg);

    //add name spaces.
    if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
      source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
    }
    if (!source.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
      source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
    }

    //add xml declaration
    source = '<?xml version="1.0" standalone="no"?>\r\n' + source;

    //convert svg source to URI data scheme.
    var url = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(source);

    //set url value to a element's href attribute.
    var DL = document.getElementById("diagram_download");
    DL.href = url;
    DL.download = 'myFile.svg';


  </script>
</body>
